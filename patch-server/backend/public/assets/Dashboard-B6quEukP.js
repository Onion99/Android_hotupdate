import{_ as ye,r as _,o as ge,M as w,c as g,b as n,f as l,e as c,m as k,w as e,g as r,u as he,q as we,F as S,h as P,d as s,K as q,N as E,t as i,j as d,v as be,k as x,l as ke,p as xe,D as Ce,O as Te,P as Ae,Q as De}from"./index-C4_VDvs8.js";import{i as ze}from"./index-Bb6yjXMn.js";const Se={class:"dashboard"},Pe={class:"stat-content"},Le={class:"stat-info"},Re={class:"stat-value"},Ne={class:"stat-title"},Ve={key:0,class:"stat-trend"},Be={class:"card-header"},Me={style:{display:"flex","justify-content":"space-between","align-items":"center"}},$e={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Fe={class:"card-header"},Oe={class:"card-header"},je={class:"activity-item"},Ie={class:"activity-user"},Ue={class:"activity-action"},qe={key:0,class:"activity-detail"},Ee={style:{display:"flex","align-items":"center",gap:"8px"}},Ge={class:"app-icon-small"},Je=["src"],Ke={style:{"font-weight":"500"}},Qe={style:{"font-size":"12px",color:"#999"}},He={class:"card-header"},We={style:{"font-size":"12px",color:"#999","margin-top":"4px"}},Xe={style:{"font-size":"12px",color:"#999"}},Ye={class:"quick-actions"},Ze={__name:"Dashboard",setup(et){const f=he(),b=_(JSON.parse(localStorage.getItem("user")||"{}")),v=_([{title:"应用总数",value:0,icon:"Box",color:"#409eff",trend:0},{title:"补丁总数",value:0,icon:"Files",color:"#67c23a",trend:0},{title:"今日下载",value:0,icon:"Download",color:"#e6a23c",trend:0},{title:"成功率",value:"0%",icon:"SuccessFilled",color:"#f56c6c",trend:0}]),C=_([]),T=_([]),A=_([]),B=_([]),M=_([]),$=_(),L=_(7),R=_(!1),G={create_app:"创建了应用",update_app:"更新了应用",delete_app:"删除了应用",toggle_app_status:"切换了应用状态",review_app:"审核了应用",upload_patch:"上传了补丁",update_patch:"更新了补丁",delete_patch:"删除了补丁",login:"登录了系统",register_user:"注册了账号"};ge(async()=>{await Promise.all([J(),K(),Q(),H(),W(),X(),F()])});const J=async()=>{try{const{data:t}=await w.getOverview();v.value[0].value=t.totalApps||0,v.value[0].trend=t.appsTrend||0,v.value[1].value=t.totalPatches||0,v.value[1].trend=t.patchesTrend||0,v.value[2].value=t.todayDownloads||0,v.value[2].trend=t.downloadsTrend||0,v.value[3].value=(t.successRate||0).toFixed(1)+"%",v.value[3].trend=t.successRateTrend||0}catch(t){console.error("加载统计失败:",t)}},K=async()=>{if(b.value.role==="admin")try{const{data:t}=await w.getPendingApps();C.value=t.slice(0,3)}catch(t){console.error("加载待审核应用失败:",t)}},Q=async()=>{try{const{data:t}=await w.getAlerts();T.value=t||[]}catch(t){console.error("加载告警失败:",t)}},H=async()=>{if(b.value.role!=="admin"){A.value=[];return}try{const{data:t}=await w.getLogs({page:1,limit:10});A.value=t.logs||[]}catch(t){console.error("加载最近活动失败:",t)}},W=async()=>{try{const{data:t}=await w.getTopApps(5);B.value=t||[]}catch(t){console.error("加载热门应用失败:",t)}},X=async()=>{try{const{data:t}=await w.getPatches({page:1,limit:5});M.value=t.patches||[]}catch(t){console.error("加载最新补丁失败:",t)}},F=async()=>{try{R.value=!0;const{data:t}=await w.getDownloadsTrend(L.value),o=ze($.value);o.setOption({tooltip:{trigger:"axis",formatter:"{b}<br/>下载量: {c}"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:(t||[]).map(m=>m.date)},yAxis:{type:"value",minInterval:1},series:[{data:(t||[]).map(m=>m.count),type:"line",smooth:!0,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.05)"}]}},lineStyle:{color:"#409eff",width:2},itemStyle:{color:"#409eff"}}]}),window.addEventListener("resize",()=>o.resize())}catch(t){console.error("加载图表失败:",t)}finally{R.value=!1}},Y=t=>G[t]||t,Z=t=>t.includes("delete")?"danger":t.includes("create")?"success":t.includes("update")?"warning":"primary",N=t=>new Date(t).toLocaleString("zh-CN"),ee=t=>{const o=new Date,m=new Date(t),u=o-m,p=Math.floor(u/6e4),y=Math.floor(u/36e5),D=Math.floor(u/864e5);return p<1?"刚刚":p<60?`${p}分钟前`:y<24?`${y}小时前`:D<7?`${D}天前`:N(t)},te=t=>{f.push("/system")},ae=t=>{t.link&&f.push(t.link)},oe=()=>{f.push("/apps")},le=()=>{f.push("/patches")},se=()=>{f.push("/stats")},ne=()=>{f.push("/users")},re=()=>{f.push("/system")},ie=()=>{f.push("/logs")},de=()=>{f.push("/patches")};return(t,o)=>{const m=r("el-icon"),u=r("el-card"),p=r("el-col"),y=r("el-row"),D=r("el-badge"),h=r("el-button"),O=r("el-alert"),ce=r("el-space"),V=r("el-radio-button"),ue=r("el-radio-group"),j=r("el-link"),pe=r("el-timeline-item"),_e=r("el-timeline"),fe=r("el-empty"),z=r("el-table-column"),I=r("el-tag"),U=r("el-table"),ve=we("loading");return n(),g("div",Se,[l(y,{gutter:20},{default:e(()=>[(n(!0),g(S,null,P(v.value,a=>(n(),c(p,{xs:24,sm:12,md:6,key:a.title},{default:e(()=>[l(u,{class:"stat-card",shadow:"hover"},{default:e(()=>[s("div",Pe,[s("div",{class:"stat-icon",style:q({background:a.color})},[l(m,{size:30},{default:e(()=>[(n(),c(E(a.icon)))]),_:2},1024)],4),s("div",Le,[s("div",Re,i(a.value),1),s("div",Ne,i(a.title),1),a.trend?(n(),g("div",Ve,[l(m,{color:a.trend>0?"#67c23a":"#f56c6c"},{default:e(()=>[(n(),c(E(a.trend>0?"CaretTop":"CaretBottom")))]),_:2},1032,["color"]),s("span",{style:q({color:a.trend>0?"#67c23a":"#f56c6c"})},i(Math.abs(a.trend))+"% ",5)])):k("",!0)])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),b.value.role==="admin"&&(C.value.length>0||T.value.length>0)?(n(),c(y,{key:0,gutter:20,style:{"margin-top":"20px"}},{default:e(()=>[l(p,{span:24},{default:e(()=>[l(u,null,{header:e(()=>[s("div",Be,[o[1]||(o[1]=s("span",null,"待处理事项",-1)),l(D,{value:C.value.length+T.value.length,type:"danger"},null,8,["value"])])]),default:e(()=>[l(ce,{direction:"vertical",style:{width:"100%"}},{default:e(()=>[(n(!0),g(S,null,P(C.value,a=>(n(),c(O,{key:"app-"+a.id,title:`应用「${a.app_name}」待审核`,type:"warning","show-icon":"",closable:!1},{default:e(()=>[s("div",Me,[s("span",null,"提交者: "+i(a.owner_name)+" | 提交时间: "+i(N(a.created_at)),1),l(h,{size:"small",type:"primary",onClick:me=>te(a.id)},{default:e(()=>[...o[2]||(o[2]=[d("去审核",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["title"]))),128)),(n(!0),g(S,null,P(T.value,a=>(n(),c(O,{key:"alert-"+a.id,title:a.title,type:a.type,"show-icon":"",closable:!1},{default:e(()=>[s("div",$e,[s("span",null,i(a.message),1),l(h,{size:"small",onClick:me=>ae(a)},{default:e(()=>[...o[3]||(o[3]=[d("查看",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["title","type"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})):k("",!0),l(y,{gutter:20,style:{"margin-top":"20px"}},{default:e(()=>[l(p,{xs:24,lg:16},{default:e(()=>[l(u,null,{header:e(()=>[s("div",Fe,[o[7]||(o[7]=s("span",null,"下载趋势",-1)),l(ue,{modelValue:L.value,"onUpdate:modelValue":o[0]||(o[0]=a=>L.value=a),size:"small",onChange:F},{default:e(()=>[l(V,{label:7},{default:e(()=>[...o[4]||(o[4]=[d("7天",-1)])]),_:1}),l(V,{label:30},{default:e(()=>[...o[5]||(o[5]=[d("30天",-1)])]),_:1}),l(V,{label:90},{default:e(()=>[...o[6]||(o[6]=[d("90天",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:e(()=>[be(s("div",{ref_key:"chartRef",ref:$,style:{height:"300px"}},null,512),[[ve,R.value]])]),_:1})]),_:1}),l(p,{xs:24,lg:8},{default:e(()=>[l(u,null,{header:e(()=>[s("div",Oe,[o[9]||(o[9]=s("span",null,"最近活动",-1)),b.value.role==="admin"?(n(),c(j,{key:0,type:"primary",onClick:ie},{default:e(()=>[...o[8]||(o[8]=[d("查看全部",-1)])]),_:1})):k("",!0)])]),default:e(()=>[A.value.length>0?(n(),c(_e,{key:0},{default:e(()=>[(n(!0),g(S,null,P(A.value,a=>(n(),c(pe,{key:a.id,timestamp:N(a.created_at),placement:"top",type:Z(a.action)},{default:e(()=>[s("div",je,[s("div",Ie,i(a.username),1),s("div",Ue,i(Y(a.action)),1),a.resource_type?(n(),g("div",qe,i(a.resource_type)+" #"+i(a.resource_id),1)):k("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(n(),c(fe,{key:1,description:"暂无活动记录","image-size":80}))]),_:1})]),_:1})]),_:1}),l(y,{gutter:20,style:{"margin-top":"20px"}},{default:e(()=>[l(p,{xs:24,md:12},{default:e(()=>[l(u,null,{header:e(()=>[...o[10]||(o[10]=[s("span",null,"热门应用 Top 5",-1)])]),default:e(()=>[l(U,{data:B.value,style:{width:"100%"},"show-header":!1},{default:e(()=>[l(z,{prop:"app_name",label:"应用"},{default:e(({row:a})=>[s("div",Ee,[s("div",Ge,[a.icon?(n(),g("img",{key:0,src:a.icon,alt:""},null,8,Je)):(n(),c(m,{key:1},{default:e(()=>[l(x(ke))]),_:1}))]),s("div",null,[s("div",Ke,i(a.app_name),1),s("div",Qe,i(a.package_name),1)])])]),_:1}),l(z,{prop:"download_count",label:"下载",width:"100",align:"right"},{default:e(({row:a})=>[l(I,{type:"success"},{default:e(()=>[d(i(a.download_count),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),l(p,{xs:24,md:12},{default:e(()=>[l(u,null,{header:e(()=>[s("div",He,[o[12]||(o[12]=s("span",null,"最新补丁",-1)),l(j,{type:"primary",onClick:de},{default:e(()=>[...o[11]||(o[11]=[d("查看全部",-1)])]),_:1})])]),default:e(()=>[l(U,{data:M.value,style:{width:"100%"},"show-header":!1},{default:e(()=>[l(z,{prop:"version",label:"版本"},{default:e(({row:a})=>[s("div",null,[l(I,{type:"primary",size:"small"},{default:e(()=>[d("v"+i(a.version),1)]),_:2},1024),s("div",We,i(a.description||"无描述"),1)])]),_:1}),l(z,{prop:"created_at",label:"时间",width:"120",align:"right"},{default:e(({row:a})=>[s("div",Xe,i(ee(a.created_at)),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),l(y,{gutter:20,style:{"margin-top":"20px"}},{default:e(()=>[l(p,{span:24},{default:e(()=>[l(u,null,{header:e(()=>[...o[13]||(o[13]=[s("span",null,"快捷操作",-1)])]),default:e(()=>[s("div",Ye,[l(h,{type:"primary",onClick:oe,icon:x(xe)},{default:e(()=>[...o[14]||(o[14]=[d("创建应用",-1)])]),_:1},8,["icon"]),l(h,{type:"success",onClick:le,icon:x(Ce)},{default:e(()=>[...o[15]||(o[15]=[d("上传补丁",-1)])]),_:1},8,["icon"]),l(h,{onClick:se,icon:x(Te)},{default:e(()=>[...o[16]||(o[16]=[d("查看统计",-1)])]),_:1},8,["icon"]),b.value.role==="admin"?(n(),c(h,{key:0,onClick:ne,icon:x(Ae)},{default:e(()=>[...o[17]||(o[17]=[d("用户管理",-1)])]),_:1},8,["icon"])):k("",!0),b.value.role==="admin"?(n(),c(h,{key:1,onClick:re,icon:x(De)},{default:e(()=>[...o[18]||(o[18]=[d("系统设置",-1)])]),_:1},8,["icon"])):k("",!0)])]),_:1})]),_:1})]),_:1})])}}},ot=ye(Ze,[["__scopeId","data-v-ca691e6e"]]);export{ot as default};
