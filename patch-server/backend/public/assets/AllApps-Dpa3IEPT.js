import{_ as P,r as h,a as j,o as W,c as T,b as f,d as c,f as a,w as l,g as p,i as V,E as v,u as G,q as H,j as _,k as D,s as J,v as K,e as b,l as L,t as w,x,y as E}from"./index-BnZprTwO.js";const Q={class:"all-apps-container"},X={class:"app-name-cell"},Y={class:"app-icon-small"},ee=["src"],ae={class:"app-name"},te={class:"package-name-small"},le={__name:"AllApps",setup(ne){const S=G(),z=h([]),k=h(!1),n=j({app_name:"",package_name:"",owner_name:"",status:"",review_status:"",sort_by:"created_at_desc"}),d=j({page:1,limit:20,total:0}),s=async()=>{var o;try{k.value=!0;const e={page:d.page,limit:d.limit,...n};Object.keys(e).forEach(i=>{(e[i]===""||e[i]===null||e[i]===void 0)&&delete e[i]});const{data:u}=await V.get("/apps/admin/all",{params:e});z.value=u.apps||[],d.total=((o=u.pagination)==null?void 0:o.total)||0}catch(e){v.error("加载应用列表失败"),console.error(e)}finally{k.value=!1}},M=()=>{n.app_name="",n.package_name="",n.owner_name="",n.status="",n.review_status="",n.sort_by="created_at_desc",d.page=1,s()},R=o=>{A(o.id)},A=o=>{S.push(`/apps/${o}`)},N=async o=>{try{const e=o.status==="active"?"inactive":"active",u=e==="inactive"?"停用":"启用";await E.confirm(`确定要${u}应用"${o.app_name}"吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await V.put(`/apps/${o.id}/status`,{status:e}),v.success(`应用已${u}`),s()}catch(e){e!=="cancel"&&(v.error("操作失败"),console.error(e))}},q=async o=>{try{await E.confirm(`确定要删除应用"${o.app_name}"吗？此操作将同时删除该应用的所有补丁，且无法恢复！`,"危险操作",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error",confirmButtonClass:"el-button--danger"}),await V.delete(`/apps/${o.id}`),v.success("应用已删除"),s()}catch(e){e!=="cancel"&&(v.error("删除失败"),console.error(e))}};return W(()=>{s()}),(o,e)=>{const u=p("el-input"),i=p("el-form-item"),r=p("el-option"),C=p("el-select"),B=p("el-icon"),g=p("el-button"),I=p("el-form"),$=p("el-card"),m=p("el-table-column"),y=p("el-tag"),Z=p("el-table"),F=p("el-pagination"),O=H("loading");return f(),T("div",Q,[e[15]||(e[15]=c("div",{class:"page-header"},[c("div",null,[c("h2",null,"应用列表"),c("p",null,"管理所有用户的应用")])],-1)),a($,{class:"filter-card"},{default:l(()=>[a(I,{inline:!0,model:n},{default:l(()=>[a(i,{label:"应用名称"},{default:l(()=>[a(u,{modelValue:n.app_name,"onUpdate:modelValue":e[0]||(e[0]=t=>n.app_name=t),placeholder:"搜索应用名称",clearable:"",onClear:s},null,8,["modelValue"])]),_:1}),a(i,{label:"包名"},{default:l(()=>[a(u,{modelValue:n.package_name,"onUpdate:modelValue":e[1]||(e[1]=t=>n.package_name=t),placeholder:"搜索包名",clearable:"",onClear:s},null,8,["modelValue"])]),_:1}),a(i,{label:"所有者"},{default:l(()=>[a(u,{modelValue:n.owner_name,"onUpdate:modelValue":e[2]||(e[2]=t=>n.owner_name=t),placeholder:"搜索用户名",clearable:"",onClear:s},null,8,["modelValue"])]),_:1}),a(i,{label:"状态"},{default:l(()=>[a(C,{modelValue:n.status,"onUpdate:modelValue":e[3]||(e[3]=t=>n.status=t),placeholder:"全部状态",clearable:"",onClear:s},{default:l(()=>[a(r,{label:"活跃",value:"active"}),a(r,{label:"停用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"审核状态"},{default:l(()=>[a(C,{modelValue:n.review_status,"onUpdate:modelValue":e[4]||(e[4]=t=>n.review_status=t),placeholder:"全部",clearable:"",onClear:s},{default:l(()=>[a(r,{label:"待审核",value:"pending"}),a(r,{label:"已通过",value:"approved"}),a(r,{label:"已拒绝",value:"rejected"})]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"排序"},{default:l(()=>[a(C,{modelValue:n.sort_by,"onUpdate:modelValue":e[5]||(e[5]=t=>n.sort_by=t),onChange:s},{default:l(()=>[a(r,{label:"创建时间（新到旧）",value:"created_at_desc"}),a(r,{label:"创建时间（旧到新）",value:"created_at_asc"}),a(r,{label:"应用名称（A-Z）",value:"app_name_asc"}),a(r,{label:"应用名称（Z-A）",value:"app_name_desc"}),a(r,{label:"补丁数量（多到少）",value:"patch_count_desc"})]),_:1},8,["modelValue"])]),_:1}),a(i,null,{default:l(()=>[a(g,{type:"primary",onClick:s},{default:l(()=>[a(B,null,{default:l(()=>[a(D(J))]),_:1}),e[8]||(e[8]=_(" 搜索 ",-1))]),_:1}),a(g,{onClick:M},{default:l(()=>[...e[9]||(e[9]=[_("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a($,{class:"table-card"},{default:l(()=>[K((f(),b(Z,{data:z.value,stripe:"",onRowClick:R,style:{cursor:"pointer"}},{default:l(()=>[a(m,{prop:"app_name",label:"应用名称","min-width":"150"},{default:l(({row:t})=>[c("div",X,[c("div",Y,[t.icon?(f(),T("img",{key:0,src:t.icon,alt:""},null,8,ee)):(f(),b(B,{key:1,size:24},{default:l(()=>[a(D(L))]),_:1}))]),c("div",null,[c("div",ae,w(t.app_name),1),c("div",te,w(t.package_name),1)])])]),_:1}),a(m,{prop:"app_id",label:"App ID",width:"150"}),a(m,{prop:"owner_name",label:"所有者",width:"120"}),a(m,{prop:"patch_count",label:"补丁数",width:"100",align:"center"}),a(m,{prop:"status",label:"状态",width:"100"},{default:l(({row:t})=>[a(y,{type:t.status==="active"?"success":"info",size:"small"},{default:l(()=>[_(w(t.status==="active"?"活跃":"停用"),1)]),_:2},1032,["type"])]),_:1}),a(m,{prop:"review_status",label:"审核状态",width:"100"},{default:l(({row:t})=>[t.review_status==="pending"?(f(),b(y,{key:0,type:"warning",size:"small"},{default:l(()=>[...e[10]||(e[10]=[_(" 待审核 ",-1)])]),_:1})):t.review_status==="rejected"?(f(),b(y,{key:1,type:"danger",size:"small"},{default:l(()=>[...e[11]||(e[11]=[_(" 已拒绝 ",-1)])]),_:1})):(f(),b(y,{key:2,type:"success",size:"small"},{default:l(()=>[...e[12]||(e[12]=[_(" 已通过 ",-1)])]),_:1}))]),_:1}),a(m,{prop:"created_at",label:"创建时间",width:"180"}),a(m,{label:"操作",width:"250",fixed:"right"},{default:l(({row:t})=>[a(g,{size:"small",onClick:x(U=>A(t.id),["stop"])},{default:l(()=>[...e[13]||(e[13]=[_("查看",-1)])]),_:1},8,["onClick"]),a(g,{size:"small",type:t.status==="active"?"warning":"success",onClick:x(U=>N(t),["stop"])},{default:l(()=>[_(w(t.status==="active"?"停用":"启用"),1)]),_:2},1032,["type","onClick"]),a(g,{size:"small",type:"danger",onClick:x(U=>q(t),["stop"])},{default:l(()=>[...e[14]||(e[14]=[_(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,k.value]]),a(F,{"current-page":d.page,"onUpdate:currentPage":e[6]||(e[6]=t=>d.page=t),"page-size":d.limit,"onUpdate:pageSize":e[7]||(e[7]=t=>d.limit=t),total:d.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:s,onSizeChange:s,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1})])}}},se=P(le,[["__scopeId","data-v-ada3b55a"]]);export{se as default};
