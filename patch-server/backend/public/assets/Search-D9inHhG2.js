import{_ as F,r as w,a as I,o as U,B as j,A as J,i as O,c as r,b as l,d as n,f as a,t as u,w as t,g as m,u as P,q as Q,e as p,m as h,v as L,F as S,h as B,k as N,l as D,j as g}from"./index-BnZprTwO.js";const W={class:"search-container"},G={class:"search-header"},K={class:"search-results"},X={key:0,class:"result-section"},Y={class:"apps-grid"},Z=["onClick"],ee={class:"app-icon-small"},ae=["src"],te={class:"app-info"},se=["innerHTML"],le=["innerHTML"],ne={key:1,class:"result-section"},oe=["innerHTML"],ie={key:2,class:"result-section"},re=["innerHTML"],ce=["innerHTML"],de={class:"apps-grid"},ue=["onClick"],_e={class:"app-icon-small"},pe=["src"],he={class:"app-info"},me=["innerHTML"],ve=["innerHTML"],fe=["innerHTML"],ge=["innerHTML"],ye=["innerHTML"],be={__name:"Search",setup(ke){const H=j(),M=P(),C=w(JSON.parse(localStorage.getItem("user")||"{}")),_=w(""),$=w("all"),c=w(!1),s=I({apps:[],patches:[],users:[]});U(()=>{_.value=H.query.q||"",_.value&&R()}),J(()=>H.query.q,o=>{_.value=o||"",_.value&&R()});const R=async()=>{if(_.value.trim())try{c.value=!0;const{data:o}=await O.get("/search",{params:{q:_.value}});s.apps=o.apps||[],s.patches=o.patches||[],s.users=o.users||[]}catch(o){console.error("搜索失败:",o)}finally{c.value=!1}},d=o=>{if(!o||!_.value)return o;const v=new RegExp(`(${_.value})`,"gi");return o.replace(v,"<mark>$1</mark>")},q=o=>{M.push(`/apps/${o}`)},V=o=>{M.push(`/apps/${o.app_id}`)},x=o=>{M.push("/users")};return(o,v)=>{const z=m("el-icon"),f=m("el-tag"),i=m("el-table-column"),y=m("el-table"),b=m("el-empty"),k=m("el-tab-pane"),A=m("el-tabs"),T=Q("loading");return l(),r("div",W,[n("div",G,[v[1]||(v[1]=n("h2",null,"搜索结果",-1)),n("p",null,'关键词: "'+u(_.value)+'"',1)]),a(A,{modelValue:$.value,"onUpdate:modelValue":v[0]||(v[0]=e=>$.value=e)},{default:t(()=>[a(k,{label:"全部",name:"all"},{default:t(()=>[L((l(),r("div",K,[s.apps.length>0?(l(),r("div",X,[n("h3",null,"应用 ("+u(s.apps.length)+")",1),n("div",Y,[(l(!0),r(S,null,B(s.apps,e=>(l(),r("div",{class:"app-card",key:"app-"+e.id,onClick:E=>q(e.id)},[n("div",ee,[e.icon?(l(),r("img",{key:0,src:e.icon,alt:""},null,8,ae)):(l(),p(z,{key:1},{default:t(()=>[a(N(D))]),_:1}))]),n("div",te,[n("div",{class:"app-name",innerHTML:d(e.app_name)},null,8,se),n("div",{class:"package-name",innerHTML:d(e.package_name)},null,8,le)]),a(f,{type:e.status==="active"?"success":"info",size:"small"},{default:t(()=>[g(u(e.status==="active"?"活跃":"停用"),1)]),_:2},1032,["type"])],8,Z))),128))])])):h("",!0),s.patches.length>0?(l(),r("div",ne,[n("h3",null,"补丁 ("+u(s.patches.length)+")",1),a(y,{data:s.patches,onRowClick:V},{default:t(()=>[a(i,{label:"版本",width:"120"},{default:t(({row:e})=>[a(f,{type:"primary",size:"small"},{default:t(()=>[g("v"+u(e.version),1)]),_:2},1024)]),_:1}),a(i,{prop:"app_name",label:"应用",width:"200"}),a(i,{label:"描述"},{default:t(({row:e})=>[n("span",{innerHTML:d(e.description||"无描述")},null,8,oe)]),_:1}),a(i,{prop:"created_at",label:"创建时间",width:"180"})]),_:1},8,["data"])])):h("",!0),C.value.role==="admin"&&s.users.length>0?(l(),r("div",ie,[n("h3",null,"用户 ("+u(s.users.length)+")",1),a(y,{data:s.users,onRowClick:x},{default:t(()=>[a(i,{label:"用户名",width:"150"},{default:t(({row:e})=>[n("span",{innerHTML:d(e.username)},null,8,re)]),_:1}),a(i,{label:"邮箱"},{default:t(({row:e})=>[n("span",{innerHTML:d(e.email||"未设置")},null,8,ce)]),_:1}),a(i,{prop:"role",label:"角色",width:"100"},{default:t(({row:e})=>[a(f,{type:e.role==="admin"?"warning":"info",size:"small"},{default:t(()=>[g(u(e.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"created_at",label:"注册时间",width:"180"})]),_:1},8,["data"])])):h("",!0),!c.value&&s.apps.length===0&&s.patches.length===0&&s.users.length===0?(l(),p(b,{key:3,description:"未找到相关结果"})):h("",!0)])),[[T,c.value]])]),_:1}),a(k,{label:`应用 (${s.apps.length})`,name:"apps"},{default:t(()=>[L((l(),r("div",de,[(l(!0),r(S,null,B(s.apps,e=>(l(),r("div",{class:"app-card",key:e.id,onClick:E=>q(e.id)},[n("div",_e,[e.icon?(l(),r("img",{key:0,src:e.icon,alt:""},null,8,pe)):(l(),p(z,{key:1},{default:t(()=>[a(N(D))]),_:1}))]),n("div",he,[n("div",{class:"app-name",innerHTML:d(e.app_name)},null,8,me),n("div",{class:"package-name",innerHTML:d(e.package_name)},null,8,ve)]),a(f,{type:e.status==="active"?"success":"info",size:"small"},{default:t(()=>[g(u(e.status==="active"?"活跃":"停用"),1)]),_:2},1032,["type"])],8,ue))),128)),!c.value&&s.apps.length===0?(l(),p(b,{key:0,description:"未找到相关应用"})):h("",!0)])),[[T,c.value]])]),_:1},8,["label"]),a(k,{label:`补丁 (${s.patches.length})`,name:"patches"},{default:t(()=>[L((l(),p(y,{data:s.patches,onRowClick:V},{default:t(()=>[a(i,{label:"版本",width:"120"},{default:t(({row:e})=>[a(f,{type:"primary",size:"small"},{default:t(()=>[g("v"+u(e.version),1)]),_:2},1024)]),_:1}),a(i,{prop:"app_name",label:"应用",width:"200"}),a(i,{label:"描述"},{default:t(({row:e})=>[n("span",{innerHTML:d(e.description||"无描述")},null,8,fe)]),_:1}),a(i,{prop:"created_at",label:"创建时间",width:"180"})]),_:1},8,["data"])),[[T,c.value]]),!c.value&&s.patches.length===0?(l(),p(b,{key:0,description:"未找到相关补丁"})):h("",!0)]),_:1},8,["label"]),C.value.role==="admin"?(l(),p(k,{key:0,label:`用户 (${s.users.length})`,name:"users"},{default:t(()=>[L((l(),p(y,{data:s.users,onRowClick:x},{default:t(()=>[a(i,{label:"用户名",width:"150"},{default:t(({row:e})=>[n("span",{innerHTML:d(e.username)},null,8,ge)]),_:1}),a(i,{label:"邮箱"},{default:t(({row:e})=>[n("span",{innerHTML:d(e.email||"未设置")},null,8,ye)]),_:1}),a(i,{prop:"role",label:"角色",width:"100"},{default:t(({row:e})=>[a(f,{type:e.role==="admin"?"warning":"info",size:"small"},{default:t(()=>[g(u(e.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"created_at",label:"注册时间",width:"180"})]),_:1},8,["data"])),[[T,c.value]]),!c.value&&s.users.length===0?(l(),p(b,{key:0,description:"未找到相关用户"})):h("",!0)]),_:1},8,["label"])):h("",!0)]),_:1},8,["modelValue"])])}}},we=F(be,[["__scopeId","data-v-1a4d3fe4"]]);export{we as default};
