import{_ as W,r,a as $,o as G,M as y,c as m,b as d,d as o,f as e,w as a,g as n,q as H,k as g,R as J,t as _,S as K,O as Q,P as X,e as h,j as u,v as Y}from"./index-DJLau6vM.js";import{i as D}from"./index-Bb6yjXMn.js";const Z={class:"stats-container"},tt={class:"stat-content"},et={class:"stat-info"},at={class:"stat-value"},st={class:"stat-content"},ot={class:"stat-info"},lt={class:"stat-value"},nt={class:"stat-content"},rt={class:"stat-info"},it={class:"stat-value"},ct={class:"stat-content"},dt={class:"stat-info"},ut={class:"stat-value"},_t={style:{display:"flex","justify-content":"space-between","align-items":"center"}},pt={__name:"Stats",setup(ft){const k=r(),C=r(),R=r(),b=r(!1),w=r(7),v=$({totalPatches:0,totalDownloads:0,successRate:0,activeUsers:0}),S=r([]),z=r([]),V=r([]),O=r([]);G(async()=>{await B(),await P(),await T(),await j(),await U()});const B=async()=>{try{const{data:t}=await y.getOverview();Object.assign(v,t)}catch(t){console.error("加载概览失败:",t)}},P=async()=>{try{const{data:t}=await y.getDownloadsTrend(w.value);S.value=t||[],t&&t.length>0&&D(R.value).setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:t.map(l=>l.date)},yAxis:{type:"value"},series:[{type:"line",data:t.map(l=>l.count),smooth:!0,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(212, 175, 122, 0.3)"},{offset:1,color:"rgba(212, 175, 122, 0.05)"}]}},itemStyle:{color:"#d4af7a"}}]})}catch(t){console.error("加载下载趋势失败:",t)}},T=async()=>{try{const{data:t}=await y.getVersionDistribution();z.value=t||[],t&&t.length>0&&D(k.value).setOption({tooltip:{trigger:"item"},series:[{type:"pie",radius:"60%",data:t.map(l=>({name:l.version,value:l.count})),itemStyle:{borderRadius:8,borderColor:"#fff",borderWidth:2},label:{formatter:"{b}: {c} ({d}%)"}}]})}catch(t){console.error("加载版本分布失败:",t)}},j=async()=>{try{const{data:t}=await y.getDeviceDistribution();V.value=t||[],t&&t.length>0&&D(C.value).setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:t.map(l=>l.model),axisLabel:{rotate:45}},yAxis:{type:"value"},series:[{type:"bar",data:t.map(l=>l.count),itemStyle:{color:"#d4af7a",borderRadius:[4,4,0,0]}}]})}catch(t){console.error("加载设备分布失败:",t)}},U=async()=>{try{b.value=!0;const{data:t}=await y.getPatches({page:1,limit:10});O.value=t.patches||[]}catch(t){console.error("加载补丁列表失败:",t)}finally{b.value=!1}},L=t=>{const s=(t.success_count||0)+(t.fail_count||0);return s===0?"N/A":`${((t.success_count||0)/s*100).toFixed(1)}%`},M=t=>new Date(t).toLocaleString("zh-CN");return(t,s)=>{const l=n("el-icon"),i=n("el-card"),p=n("el-col"),A=n("el-row"),N=n("el-radio-button"),q=n("el-radio-group"),x=n("el-empty"),f=n("el-table-column"),E=n("el-tag"),F=n("el-table"),I=H("loading");return d(),m("div",Z,[s[11]||(s[11]=o("h2",{style:{"margin-bottom":"24px"}},"统计分析",-1)),e(A,{gutter:20,style:{"margin-bottom":"20px"}},{default:a(()=>[e(p,{span:6},{default:a(()=>[e(i,{class:"stat-card"},{default:a(()=>[o("div",tt,[e(l,{size:40,color:"#d4af7a"},{default:a(()=>[e(g(J))]),_:1}),o("div",et,[o("div",at,_(v.totalPatches),1),s[1]||(s[1]=o("div",{class:"stat-label"},"补丁总数",-1))])])]),_:1})]),_:1}),e(p,{span:6},{default:a(()=>[e(i,{class:"stat-card"},{default:a(()=>[o("div",st,[e(l,{size:40,color:"#67c23a"},{default:a(()=>[e(g(K))]),_:1}),o("div",ot,[o("div",lt,_(v.totalDownloads),1),s[2]||(s[2]=o("div",{class:"stat-label"},"总下载次数",-1))])])]),_:1})]),_:1}),e(p,{span:6},{default:a(()=>[e(i,{class:"stat-card"},{default:a(()=>[o("div",nt,[e(l,{size:40,color:"#409eff"},{default:a(()=>[e(g(Q))]),_:1}),o("div",rt,[o("div",it,_(v.successRate)+"%",1),s[3]||(s[3]=o("div",{class:"stat-label"},"成功率",-1))])])]),_:1})]),_:1}),e(p,{span:6},{default:a(()=>[e(i,{class:"stat-card"},{default:a(()=>[o("div",ct,[e(l,{size:40,color:"#e6a23c"},{default:a(()=>[e(g(X))]),_:1}),o("div",dt,[o("div",ut,_(v.activeUsers),1),s[4]||(s[4]=o("div",{class:"stat-label"},"活跃用户（7天）",-1))])])]),_:1})]),_:1})]),_:1}),e(i,{style:{"margin-bottom":"20px"}},{header:a(()=>[o("div",_t,[s[7]||(s[7]=o("span",null,"下载趋势",-1)),e(q,{modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=c=>w.value=c),size:"small",onChange:P},{default:a(()=>[e(N,{label:7},{default:a(()=>[...s[5]||(s[5]=[u("7天",-1)])]),_:1}),e(N,{label:30},{default:a(()=>[...s[6]||(s[6]=[u("30天",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:a(()=>[S.value.length>0?(d(),m("div",{key:0,ref_key:"trendChartRef",ref:R,style:{height:"300px"}},null,512)):(d(),h(x,{key:1,description:"暂无下载数据"}))]),_:1}),e(A,{gutter:20},{default:a(()=>[e(p,{span:12},{default:a(()=>[e(i,null,{header:a(()=>[...s[8]||(s[8]=[u("版本分布",-1)])]),default:a(()=>[z.value.length>0?(d(),m("div",{key:0,ref_key:"versionChartRef",ref:k,style:{height:"300px"}},null,512)):(d(),h(x,{key:1,description:"暂无版本数据","image-size":100}))]),_:1})]),_:1}),e(p,{span:12},{default:a(()=>[e(i,null,{header:a(()=>[...s[9]||(s[9]=[u("设备分布",-1)])]),default:a(()=>[V.value.length>0?(d(),m("div",{key:0,ref_key:"deviceChartRef",ref:C,style:{height:"300px"}},null,512)):(d(),h(x,{key:1,description:"暂无设备数据","image-size":100}))]),_:1})]),_:1})]),_:1}),e(i,{style:{"margin-top":"20px"}},{header:a(()=>[...s[10]||(s[10]=[u("补丁统计",-1)])]),default:a(()=>[Y((d(),h(F,{data:O.value},{default:a(()=>[e(f,{prop:"version",label:"版本",width:"120"}),e(f,{prop:"download_count",label:"下载次数",width:"120"}),e(f,{label:"成功率",width:"120"},{default:a(({row:c})=>[u(_(L(c)),1)]),_:1}),e(f,{prop:"status",label:"状态",width:"100"},{default:a(({row:c})=>[e(E,{type:c.status==="active"?"success":"info"},{default:a(()=>[u(_(c.status==="active"?"活跃":"停用"),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:c})=>[u(_(M(c.created_at)),1)]),_:1}),e(f,{prop:"description",label:"描述"})]),_:1},8,["data"])),[[I,b.value]])]),_:1})])}}},mt=W(pt,[["__scopeId","data-v-04efc9be"]]);export{mt as default};
