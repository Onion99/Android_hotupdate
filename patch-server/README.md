# ğŸš€ è¡¥ä¸æœåŠ¡ç«¯ - è‡ªæ‰˜ç®¡æ–¹æ¡ˆ

å®Œæ•´çš„è¡¥ä¸ç®¡ç†æœåŠ¡ç«¯ï¼Œæ”¯æŒè¡¥ä¸ä¸Šä¼ ã€ç‰ˆæœ¬ç®¡ç†ã€ç°åº¦å‘å¸ƒã€ç»Ÿè®¡åˆ†æç­‰åŠŸèƒ½ã€‚

## ğŸ“¦ æŠ€æœ¯æ ˆ

### åç«¯
- **Node.js + Express** - RESTful API
- **SQLite/MySQL** - æ•°æ®åº“
- **Multer** - æ–‡ä»¶ä¸Šä¼ 
- **JWT** - èº«ä»½è®¤è¯

### å‰ç«¯ç®¡ç†åå°
- **Vue 3 + Element Plus** - ç®¡ç†ç•Œé¢
- **Vite** - æ„å»ºå·¥å…·

### éƒ¨ç½²
- **Docker** - å®¹å™¨åŒ–éƒ¨ç½²
- **Nginx** - åå‘ä»£ç†
- æ”¯æŒ Vercelã€Railwayã€Render ç­‰å¹³å°

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… è¡¥ä¸ä¸Šä¼ å’Œç®¡ç†
- âœ… ç‰ˆæœ¬æ§åˆ¶
- âœ… ç°åº¦å‘å¸ƒï¼ˆæŒ‰ç™¾åˆ†æ¯”ã€ç”¨æˆ· IDã€è®¾å¤‡å‹å·ï¼‰
- âœ… å¼ºåˆ¶æ›´æ–°
- âœ… è¡¥ä¸å›æ»š
- âœ… MD5 æ ¡éªŒ

### ç®¡ç†åŠŸèƒ½
- âœ… Web ç®¡ç†åå°
- âœ… ç”¨æˆ·æƒé™ç®¡ç†
- âœ… æ“ä½œæ—¥å¿—
- âœ… è¡¥ä¸å®¡æ ¸æµç¨‹

### ç»Ÿè®¡åˆ†æ
- âœ… ä¸‹è½½ç»Ÿè®¡
- âœ… åº”ç”¨æˆåŠŸç‡
- âœ… è®¾å¤‡åˆ†å¸ƒ
- âœ… ç‰ˆæœ¬åˆ†å¸ƒ

### å®‰å…¨åŠŸèƒ½
- âœ… API è®¤è¯
- âœ… æ–‡ä»¶ç­¾åéªŒè¯
- âœ… è®¿é—®é¢‘ç‡é™åˆ¶
- âœ… IP ç™½åå•

## ğŸ“ é¡¹ç›®ç»“æ„

```
patch-server/
â”œâ”€â”€ backend/                 # åç«¯ API
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/    # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ routes/         # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ uploads/            # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ database.db         # SQLite æ•°æ®åº“
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ server.js           # å…¥å£æ–‡ä»¶
â”‚
â”œâ”€â”€ frontend/               # å‰ç«¯ç®¡ç†åå°
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/         # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ components/    # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ api/           # API è°ƒç”¨
â”‚   â”‚   â””â”€â”€ router/        # è·¯ç”±
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.js
â”‚
â”œâ”€â”€ docker/                 # Docker é…ç½®
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â””â”€â”€ nginx.conf
â”‚
â””â”€â”€ docs/                   # æ–‡æ¡£
    â”œâ”€â”€ API.md             # API æ–‡æ¡£
    â”œâ”€â”€ DEPLOY.md          # éƒ¨ç½²æ–‡æ¡£
    â””â”€â”€ DEVELOPMENT.md     # å¼€å‘æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ¬åœ°å¼€å‘

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/706412584/Android_hotupdate.git
cd Android_hotupdate/patch-server

# 2. å®‰è£…åç«¯ä¾èµ–
cd backend
npm install

# 3. å¯åŠ¨åç«¯
npm run dev
# åç«¯è¿è¡Œåœ¨ http://localhost:3000

# 4. å®‰è£…å‰ç«¯ä¾èµ–
cd ../frontend
npm install

# 5. å¯åŠ¨å‰ç«¯
npm run dev
# å‰ç«¯è¿è¡Œåœ¨ http://localhost:5173
```

### Docker éƒ¨ç½²

```bash
# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# è®¿é—®
# ç®¡ç†åå°: http://localhost:8080
# API: http://localhost:3000
```

### äº‘å¹³å°éƒ¨ç½²

#### Vercelï¼ˆæ¨èï¼‰
```bash
# å®‰è£… Vercel CLI
npm i -g vercel

# éƒ¨ç½²åç«¯
cd backend
vercel

# éƒ¨ç½²å‰ç«¯
cd ../frontend
vercel
```

#### Railway
```bash
# è¿æ¥ GitHub ä»“åº“
# è‡ªåŠ¨æ£€æµ‹å¹¶éƒ¨ç½²
```

#### Render
```bash
# åˆ›å»º Web Service
# è¿æ¥ GitHub ä»“åº“
# è‡ªåŠ¨éƒ¨ç½²
```

## ğŸ“– API æ–‡æ¡£

### è®¤è¯

```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "password"
}

Response:
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "username": "admin",
    "role": "admin"
  }
}
```

### è¡¥ä¸ç®¡ç†

#### ä¸Šä¼ è¡¥ä¸
```http
POST /api/patches/upload
Authorization: Bearer <token>
Content-Type: multipart/form-data

{
  "file": <patch.zip>,
  "version": "1.4.1",
  "baseVersion": "1.4.0",
  "description": "ä¿®å¤ SIGBUS å´©æºƒ",
  "forceUpdate": false
}
```

#### è·å–è¡¥ä¸åˆ—è¡¨
```http
GET /api/patches?page=1&limit=10
Authorization: Bearer <token>

Response:
{
  "patches": [...],
  "total": 100,
  "page": 1,
  "limit": 10
}
```

#### æ£€æŸ¥æ›´æ–°ï¼ˆå®¢æˆ·ç«¯ï¼‰
```http
GET /api/client/check-update?version=1.4.0&deviceId=xxx

Response:
{
  "hasUpdate": true,
  "patch": {
    "version": "1.4.1",
    "downloadUrl": "https://your-domain.com/downloads/patch-1.4.1.zip",
    "md5": "abc123...",
    "size": 1024000,
    "description": "ä¿®å¤è¯´æ˜",
    "forceUpdate": false
  }
}
```

#### ä¸‹è½½è¡¥ä¸
```http
GET /api/client/download/:patchId

Response: <binary file>
```

### ç»Ÿè®¡åˆ†æ

```http
GET /api/stats/overview
Authorization: Bearer <token>

Response:
{
  "totalPatches": 10,
  "totalDownloads": 1000,
  "successRate": 98.5,
  "activeUsers": 500
}
```

## ğŸ”§ é…ç½®

### ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=production

# æ•°æ®åº“é…ç½®
DB_TYPE=sqlite
DB_PATH=./database.db
# æˆ–ä½¿ç”¨ MySQL
# DB_TYPE=mysql
# DB_HOST=localhost
# DB_PORT=3306
# DB_USER=root
# DB_PASSWORD=password
# DB_NAME=patch_server

# JWT é…ç½®
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=7d

# æ–‡ä»¶å­˜å‚¨
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=100MB

# CDN é…ç½®ï¼ˆå¯é€‰ï¼‰
CDN_URL=https://cdn.example.com

# é‚®ä»¶é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-password
```

## ğŸ”’ å®‰å…¨é…ç½®

### API è®¤è¯

æ‰€æœ‰ç®¡ç† API éœ€è¦ JWT tokenï¼š

```javascript
// è¯·æ±‚å¤´
Authorization: Bearer <token>
```

### é¢‘ç‡é™åˆ¶

```javascript
// æ¯ä¸ª IP æ¯åˆ†é’Ÿæœ€å¤š 60 æ¬¡è¯·æ±‚
app.use(rateLimit({
  windowMs: 60 * 1000,
  max: 60
}));
```

### CORS é…ç½®

```javascript
app.use(cors({
  origin: ['https://your-domain.com'],
  credentials: true
}));
```

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### patches è¡¨
```sql
CREATE TABLE patches (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  version VARCHAR(20) NOT NULL,
  patch_id VARCHAR(50) UNIQUE NOT NULL,
  base_version VARCHAR(20) NOT NULL,
  file_path VARCHAR(255) NOT NULL,
  file_size INTEGER NOT NULL,
  md5 VARCHAR(32) NOT NULL,
  description TEXT,
  force_update BOOLEAN DEFAULT 0,
  rollout_percentage INTEGER DEFAULT 100,
  status VARCHAR(20) DEFAULT 'active',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### downloads è¡¨
```sql
CREATE TABLE downloads (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  patch_id INTEGER NOT NULL,
  device_id VARCHAR(100),
  version VARCHAR(20),
  device_model VARCHAR(100),
  os_version VARCHAR(20),
  ip_address VARCHAR(45),
  success BOOLEAN,
  error_message TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (patch_id) REFERENCES patches(id)
);
```

### users è¡¨
```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username VARCHAR(50) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  email VARCHAR(100),
  role VARCHAR(20) DEFAULT 'user',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸ¨ ç®¡ç†åå°åŠŸèƒ½

### ä»ªè¡¨æ¿
- è¡¥ä¸æ€»æ•°
- ä¸‹è½½ç»Ÿè®¡
- æˆåŠŸç‡
- æ´»è·ƒç”¨æˆ·

### è¡¥ä¸ç®¡ç†
- ä¸Šä¼ è¡¥ä¸
- ç¼–è¾‘è¡¥ä¸ä¿¡æ¯
- åˆ é™¤è¡¥ä¸
- å¯ç”¨/ç¦ç”¨è¡¥ä¸

### ç°åº¦å‘å¸ƒ
- è®¾ç½®å‘å¸ƒç™¾åˆ†æ¯”
- æŒ‡å®šç›®æ ‡ç”¨æˆ·
- è®¾å¤‡å‹å·è¿‡æ»¤
- åœ°åŒºè¿‡æ»¤

### ç»Ÿè®¡åˆ†æ
- ä¸‹è½½è¶‹åŠ¿å›¾
- ç‰ˆæœ¬åˆ†å¸ƒ
- è®¾å¤‡åˆ†å¸ƒ
- é”™è¯¯æ—¥å¿—

### ç³»ç»Ÿè®¾ç½®
- ç”¨æˆ·ç®¡ç†
- æƒé™é…ç½®
- ç³»ç»Ÿæ—¥å¿—
- å¤‡ä»½æ¢å¤

## ğŸŒ éƒ¨ç½²å»ºè®®

### å°å‹é¡¹ç›®ï¼ˆ< 1000 ç”¨æˆ·ï¼‰
- **Vercel/Netlify** - å‰ç«¯
- **Railway/Render** - åç«¯
- **SQLite** - æ•°æ®åº“
- **æˆæœ¬**: å…è´¹

### ä¸­å‹é¡¹ç›®ï¼ˆ1000-10000 ç”¨æˆ·ï¼‰
- **Cloudflare Pages** - å‰ç«¯
- **VPS (2æ ¸4G)** - åç«¯
- **MySQL** - æ•°æ®åº“
- **æˆæœ¬**: $5-10/æœˆ

### å¤§å‹é¡¹ç›®ï¼ˆ> 10000 ç”¨æˆ·ï¼‰
- **CDN** - é™æ€èµ„æº
- **è´Ÿè½½å‡è¡¡** - å¤šå®ä¾‹
- **MySQL é›†ç¾¤** - æ•°æ®åº“
- **Redis** - ç¼“å­˜
- **æˆæœ¬**: $50+/æœˆ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- ğŸ“– [å®Œæ•´æ–‡æ¡£](./docs/)
- ğŸ› [æŠ¥å‘Šé—®é¢˜](https://github.com/706412584/Android_hotupdate/issues)
- ğŸ’¬ [è®¨è®ºåŒº](https://github.com/706412584/Android_hotupdate/discussions)
