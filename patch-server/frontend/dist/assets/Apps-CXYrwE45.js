import{_ as N,r as w,a as q,o as E,c,b as r,d as l,e as f,f as a,w as s,g as i,F as I,h as L,i as z,E as p,u as M,j as _,k as A,p as T,n as O,l as S,m as G,t as v}from"./index-DJLau6vM.js";const H={class:"apps-container"},J={class:"page-header"},K={key:0,class:"apps-grid"},P=["onClick"],Q={class:"app-icon"},W=["src"],X={class:"app-info"},Y={class:"package-name"},Z={key:0,class:"app-desc"},ee={class:"app-stats"},te={class:"stat-item"},ae={class:"stat-value"},se={class:"stat-item"},le={__name:"Apps",setup(oe){const U=M(),V=w([]),m=w(!1),b=w(!1),x=w(null),o=q({app_name:"",package_name:"",description:"",icon:""}),$={app_name:[{required:!0,message:"请输入应用名称",trigger:"blur"}],package_name:[{required:!0,message:"请输入包名",trigger:"blur"},{pattern:/^[a-z][a-z0-9_]*(\.[a-z][a-z0-9_]*)+$/,message:"请输入有效的包名",trigger:"blur"}]},C=async()=>{try{const{data:n}=await z.get("/apps");V.value=n}catch{p.error("加载应用列表失败")}},h=async()=>{var n,e,g,u;try{await x.value.validate(),b.value=!0;const d=await z.post("/apps",o);((n=d.data.app)==null?void 0:n.review_status)==="pending"?p.warning("应用已提交，请等待管理员审核"):p.success(`应用创建成功，App ID: ${(e=d.data.app)==null?void 0:e.app_id}`),m.value=!1,Object.assign(o,{app_name:"",package_name:"",description:"",icon:""}),C()}catch(d){p.error(((u=(g=d.response)==null?void 0:g.data)==null?void 0:u.error)||"创建失败")}finally{b.value=!1}},D=n=>{if(n.review_status==="pending"){p.warning("应用正在审核中，暂时无法管理");return}if(n.review_status==="rejected"){p.error("应用已被拒绝，无法管理");return}if(n.status==="inactive"){p.warning("应用已停用，无法管理");return}U.push(`/apps/${n.id}`)};return E(()=>{C()}),(n,e)=>{const g=i("el-icon"),u=i("el-button"),d=i("el-tag"),F=i("el-empty"),y=i("el-input"),k=i("el-form-item"),R=i("el-alert"),j=i("el-form"),B=i("el-dialog");return r(),c("div",H,[l("div",J,[e[8]||(e[8]=l("div",null,[l("h2",null,"我的应用"),l("p",null,"管理你的 Android 应用和补丁")],-1)),a(u,{type:"primary",onClick:e[0]||(e[0]=t=>m.value=!0),size:"large"},{default:s(()=>[a(g,null,{default:s(()=>[a(A(T))]),_:1}),e[7]||(e[7]=_(" 创建应用 ",-1))]),_:1})]),V.value.length>0?(r(),c("div",K,[(r(!0),c(I,null,L(V.value,t=>(r(),c("div",{class:O(["app-card",{"pending-review":t.review_status==="pending","inactive-app":t.status==="inactive"}]),key:t.id,onClick:ne=>D(t)},[l("div",Q,[t.icon?(r(),c("img",{key:0,src:t.icon,alt:""},null,8,W)):(r(),f(g,{key:1,size:40},{default:s(()=>[a(A(S))]),_:1}))]),l("div",X,[l("h3",null,v(t.app_name),1),l("p",Y,v(t.package_name),1),t.description?(r(),c("p",Z,v(t.description),1)):G("",!0)]),l("div",ee,[l("div",te,[l("span",ae,v(t.patch_count||0),1),e[9]||(e[9]=l("span",{class:"stat-label"},"补丁",-1))]),l("div",se,[t.review_status==="pending"?(r(),f(d,{key:0,type:"warning",size:"small"},{default:s(()=>[...e[10]||(e[10]=[_(" 待审核 ",-1)])]),_:1})):t.review_status==="rejected"?(r(),f(d,{key:1,type:"danger",size:"small"},{default:s(()=>[...e[11]||(e[11]=[_(" 已拒绝 ",-1)])]),_:1})):(r(),f(d,{key:2,type:t.status==="active"?"success":"info",size:"small"},{default:s(()=>[_(v(t.status==="active"?"活跃":"停用"),1)]),_:2},1032,["type"]))])])],10,P))),128))])):(r(),f(F,{key:1,description:"还没有应用，创建一个开始吧"})),a(B,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=t=>m.value=t),title:"创建应用",width:"500px"},{footer:s(()=>[a(u,{onClick:e[5]||(e[5]=t=>m.value=!1)},{default:s(()=>[...e[12]||(e[12]=[_("取消",-1)])]),_:1}),a(u,{type:"primary",onClick:h,loading:b.value},{default:s(()=>[...e[13]||(e[13]=[_("创建",-1)])]),_:1},8,["loading"])]),default:s(()=>[a(j,{model:o,rules:$,ref_key:"createFormRef",ref:x,"label-width":"100px"},{default:s(()=>[a(k,{label:"应用名称",prop:"app_name"},{default:s(()=>[a(y,{modelValue:o.app_name,"onUpdate:modelValue":e[1]||(e[1]=t=>o.app_name=t),placeholder:"如: 我的应用"},null,8,["modelValue"])]),_:1}),a(k,{label:"包名",prop:"package_name"},{default:s(()=>[a(y,{modelValue:o.package_name,"onUpdate:modelValue":e[2]||(e[2]=t=>o.package_name=t),placeholder:"如: com.example.app"},null,8,["modelValue"])]),_:1}),a(k,{label:"描述"},{default:s(()=>[a(y,{modelValue:o.description,"onUpdate:modelValue":e[3]||(e[3]=t=>o.description=t),type:"textarea",rows:3,placeholder:"应用描述（可选）"},null,8,["modelValue"])]),_:1}),a(k,{label:"图标 URL"},{default:s(()=>[a(y,{modelValue:o.icon,"onUpdate:modelValue":e[4]||(e[4]=t=>o.icon=t),placeholder:"图标地址（可选）"},null,8,["modelValue"])]),_:1}),a(R,{title:"App ID 将由系统自动生成",type:"info",closable:!1,"show-icon":"",style:{"margin-top":"10px"}})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ie=N(le,[["__scopeId","data-v-22829d24"]]);export{ie as default};
