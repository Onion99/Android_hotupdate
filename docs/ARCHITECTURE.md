# æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“ æ•´ä½“æ¶æ„

### ç³»ç»Ÿæ¶æ„ï¿½?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?
ï¿½?                        åº”ç”¨ï¿½?(App)                              ï¿½?
ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?         ï¿½?
ï¿½? ï¿½?MainActivity ï¿½? ï¿½?UpdateManagerï¿½? ï¿½?PatchApplier ï¿½?         ï¿½?
ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?         ï¿½?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?
                              ï¿½?
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?
ï¿½?                   çƒ­æ›´ï¿½?SDK (update)                            ï¿½?
ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?  ï¿½?
ï¿½? ï¿½?             HotUpdateHelper (å•ä¾‹)                       ï¿½?  ï¿½?
ï¿½? ï¿½? - è¡¥ä¸åº”ç”¨   - ç‰ˆæœ¬æ£€ï¿½?  - æ ¼å¼éªŒè¯   - å®‰å…¨éªŒè¯      ï¿½?  ï¿½?
ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?  ï¿½?
ï¿½?                             ï¿½?                                  ï¿½?
ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?      ï¿½?
ï¿½? â”‚DexPatcherï¿½? â”‚SoPatcher ï¿½? â”‚ResPatcherï¿½? â”‚SecurityMgrï¿½?      ï¿½?
ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?      ï¿½?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?
                              ï¿½?
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?
ï¿½?             è¡¥ä¸ç”Ÿæˆå¼•æ“ (patch-core)                            ï¿½?
ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?  ï¿½?
ï¿½? ï¿½?                 PatchGenerator                           ï¿½?  ï¿½?
ï¿½? ï¿½? - APK è§£æ   - å·®å¼‚æ¯”è¾ƒ   - è¡¥ä¸æ‰“åŒ…   - ç­¾ååŠ å¯†      ï¿½?  ï¿½?
ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?  ï¿½?
ï¿½?                             ï¿½?                                  ï¿½?
ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?      ï¿½?
ï¿½? â”‚ApkParser ï¿½? â”‚DexDiffer ï¿½? â”‚ResDiffer ï¿½? â”‚PatchPackerï¿½?      ï¿½?
ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?      ï¿½?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?
                              ï¿½?
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?
ï¿½?             Native å¼•æ“ (patch-native)                           ï¿½?
ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?  ï¿½?
ï¿½? ï¿½?             NativePatchEngine (JNI)                      ï¿½?  ï¿½?
ï¿½? ï¿½? - BsDiff ç®—æ³•   - é«˜æ€§èƒ½å¤„ç†   - è‡ªåŠ¨é™çº§              ï¿½?  ï¿½?
ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?  ï¿½?
ï¿½?                             ï¿½?                                  ï¿½?
ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?                     ï¿½?
ï¿½? ï¿½?BsDiff   ï¿½? ï¿½?BsPatch  ï¿½? ï¿½?JKSè§£æ  ï¿½?                     ï¿½?
ï¿½? ï¿½?(C/C++)  ï¿½? ï¿½?(C/C++)  ï¿½? ï¿½?(C/C++)  ï¿½?                     ï¿½?
ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?                     ï¿½?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?
                              ï¿½?
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?
ï¿½?                  æœåŠ¡ï¿½?(patch-server)                           ï¿½?
ï¿½? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?  ï¿½?
ï¿½? ï¿½?             Web ç®¡ç†åå° + RESTful API                   ï¿½?  ï¿½?
ï¿½? ï¿½? - è¡¥ä¸ç®¡ç†   - ç°åº¦å‘å¸ƒ   - ç»Ÿè®¡åˆ†æ   - ç”¨æˆ·ç®¡ç†      ï¿½?  ï¿½?
ï¿½? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?  ï¿½?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?
```

---

## ğŸ—ï¿½?æ¨¡å—è®¾è®¡

### 1. update æ¨¡å—ï¼ˆçƒ­æ›´æ–° SDKï¿½?

**èŒè´£**: è¡¥ä¸åº”ç”¨ã€åŠ è½½ã€éªŒï¿½?

#### æ ¸å¿ƒï¿½?

```java
HotUpdateHelper (å•ä¾‹)
â”œâ”€â”€ applyPatch()           // åº”ç”¨è¡¥ä¸
â”œâ”€â”€ loadPatchIfNeeded()    // åŠ è½½å·²åº”ç”¨çš„è¡¥ä¸
â”œâ”€â”€ clearPatch()           // æ¸…é™¤è¡¥ä¸
â””â”€â”€ validatePatch()        // éªŒè¯è¡¥ä¸

DexPatcher
â”œâ”€â”€ patchDex()             // DEX çƒ­æ›´ï¿½?
â””â”€â”€ loadDex()              // åŠ è½½ DEX

SoPatcher
â”œâ”€â”€ patchSo()              // SO åº“çƒ­æ›´æ–°
â””â”€â”€ loadSo()               // åŠ è½½ SO

ResourcePatcher
â”œâ”€â”€ patchResource()        // èµ„æºçƒ­æ›´ï¿½?
â””â”€â”€ loadResource()         // åŠ è½½èµ„æº

SecurityManager
â”œâ”€â”€ encryptPatch()         // åŠ å¯†è¡¥ä¸
â”œâ”€â”€ decryptPatch()         // è§£å¯†è¡¥ä¸
â””â”€â”€ verifySignature()      // éªŒè¯ç­¾å
```

#### æ•°æ®ï¿½?

```
è¡¥ä¸æ–‡ä»¶ (patch.zip)
    ï¿½?
[æ ¼å¼éªŒè¯] ï¿½?æ£€ï¿½?ZIP é­”æ•°ã€patch.json
    ï¿½?
[åŒ…åéªŒè¯] ï¿½?ç¡®ä¿è¡¥ä¸ä¸åº”ç”¨åŒ¹ï¿½?
    ï¿½?
[ç­¾åéªŒè¯] ï¿½?éªŒè¯è¡¥ä¸ç­¾åï¼ˆå¯é€‰ï¼‰
    ï¿½?
[è§£å¯†] ï¿½?AES è§£å¯†ï¼ˆå¦‚æœåŠ å¯†ï¼‰
    ï¿½?
[è§£å‹] ï¿½?æå– DEXã€SOã€èµ„æºæ–‡ï¿½?
    ï¿½?
[åº”ç”¨è¡¥ä¸]
    â”œâ”€â”€ DexPatcher ï¿½?ä¿®æ”¹ ClassLoader
    â”œâ”€â”€ SoPatcher ï¿½?ä¿®æ”¹ nativeLibraryPathElements
    â””â”€â”€ ResourcePatcher ï¿½?æ›¿æ¢ AssetManager
    ï¿½?
[ä¿å­˜çŠ¶æ€] ï¿½?è®°å½•è¡¥ä¸ä¿¡æ¯ï¼Œä¸‹æ¬¡å¯åŠ¨åŠ ï¿½?
```

---

### 2. patch-core æ¨¡å—ï¼ˆè¡¥ä¸ç”Ÿæˆå¼•æ“ï¼‰

**èŒè´£**: APK è§£æã€å·®å¼‚æ¯”è¾ƒã€è¡¥ä¸æ‰“ï¿½?

#### æ ¸å¿ƒï¿½?

```java
PatchGenerator (æ„å»ºå™¨æ¨¡ï¿½?
â”œâ”€â”€ parse()                // è§£æ APK
â”œâ”€â”€ compare()              // æ¯”è¾ƒå·®å¼‚
â”œâ”€â”€ pack()                 // æ‰“åŒ…è¡¥ä¸
â””â”€â”€ sign()                 // ç­¾åè¡¥ä¸

ApkParser
â”œâ”€â”€ parseManifest()        // è§£æ AndroidManifest.xml
â”œâ”€â”€ parseDex()             // è§£æ DEX æ–‡ä»¶
â””â”€â”€ parseResources()       // è§£æèµ„æºæ–‡ä»¶

DexDiffer
â”œâ”€â”€ compareDex()           // æ¯”è¾ƒ DEX å·®å¼‚
â””â”€â”€ generatePatchDex()     // ç”Ÿæˆè¡¥ä¸ DEX

ResourceDiffer
â”œâ”€â”€ compareResources()     // æ¯”è¾ƒèµ„æºå·®å¼‚
â””â”€â”€ compareAssets()        // æ¯”è¾ƒ Assets å·®å¼‚

PatchPacker
â”œâ”€â”€ pack()                 // æ‰“åŒ…è¡¥ä¸
â””â”€â”€ addFile()              // æ·»åŠ æ–‡ä»¶åˆ°è¡¥ï¿½?

JarSigner
â”œâ”€â”€ sign()                 // ç­¾åè¡¥ä¸
â””â”€â”€ verify()               // éªŒè¯ç­¾å
```

#### è¡¥ä¸ç”Ÿæˆæµç¨‹

```
åŸºçº¿ APK (v1.0)  +  æ–°ç‰ˆ APK (v1.1)
    ï¿½?                   ï¿½?
[è§£æ APK]          [è§£æ APK]
    ï¿½?                   ï¿½?
ApkInfo (v1.0)      ApkInfo (v1.1)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½?
             ï¿½?
      [å·®å¼‚æ¯”è¾ƒ]
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€ï¿½?
    ï¿½?          ï¿½?
[DEX å·®å¼‚]  [èµ„æºå·®å¼‚]
    ï¿½?          ï¿½?
DexDiffResult  ResourceDiffResult
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€ï¿½?
          ï¿½?
    [ç”Ÿæˆè¡¥ä¸å†…å®¹]
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€ï¿½?
    ï¿½?          ï¿½?
patch.json   ä¿®æ”¹çš„æ–‡ï¿½?
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€ï¿½?
          ï¿½?
    [æ‰“åŒ… ZIP]
          ï¿½?
    patch.zip (æœªç­¾ï¿½?
          ï¿½?
    [ç­¾å] (å¯ï¿½?
          ï¿½?
    patch.zip (å·²ç­¾ï¿½?
```

---

### 3. patch-native æ¨¡å—ï¼ˆNative å¼•æ“ï¿½?

**èŒè´£**: é«˜æ€§èƒ½å·®å¼‚ç®—æ³•ã€JKS è§£æ

#### æ ¸å¿ƒç»„ä»¶

```cpp
// BsDiff ç®—æ³•ï¼ˆå¢é‡æ›´æ–°ï¼‰
bsdiff.cpp
â”œâ”€â”€ bsdiff()               // ç”Ÿæˆå·®å¼‚æ–‡ä»¶
â””â”€â”€ bspatch()              // åº”ç”¨å·®å¼‚æ–‡ä»¶

// JKS è§£æï¿½?
jks_parser.cpp
â”œâ”€â”€ parseKeyStore()        // è§£æ JKS æ–‡ä»¶
â”œâ”€â”€ getPrivateKey()        // è·å–ç§é’¥
â””â”€â”€ getCertificateChain()  // è·å–è¯ä¹¦ï¿½?

// JNI æ¥å£
jks_jni.cpp
â”œâ”€â”€ loadKeyStore()         // JNI: åŠ è½½ KeyStore
â”œâ”€â”€ getPrivateKey()        // JNI: è·å–ç§é’¥
â””â”€â”€ getCertificateChain()  // JNI: è·å–è¯ä¹¦ï¿½?
```

#### æ€§èƒ½ä¼˜åŒ–

- **å¤šçº¿ç¨‹å¤„ï¿½?*: å¹¶è¡Œå¤„ç†å¤šä¸ª DEX æ–‡ä»¶
- **å†…å­˜æ˜ å°„**: ä½¿ç”¨ mmap å‡å°‘å†…å­˜æ‹·è´
- **æµå¼å¤„ç†**: å¤§æ–‡ä»¶æµå¼è¯»å–ï¼Œé¿å… OOM
- **è‡ªåŠ¨é™çº§**: Native ä¸å¯ç”¨æ—¶è‡ªåŠ¨ä½¿ç”¨ Java å®ç°

---

### 4. patch-server æ¨¡å—ï¼ˆæœåŠ¡ç«¯ï¿½?

**èŒè´£**: è¡¥ä¸ç®¡ç†ã€ç°åº¦å‘å¸ƒã€ç»Ÿè®¡åˆ†ï¿½?

#### æŠ€æœ¯æ ˆ

```
å‰ç«¯: Vue 3 + Element Plus + ECharts
åç«¯: Node.js + Express + SQLite/MySQL
è®¤è¯: JWT
æ–‡ä»¶: Multer
```

#### API è®¾è®¡

```
POST   /api/auth/login              # ç”¨æˆ·ç™»å½•
POST   /api/auth/register           # ç”¨æˆ·æ³¨å†Œ

GET    /api/apps                    # è·å–åº”ç”¨åˆ—è¡¨
POST   /api/apps                    # åˆ›å»ºåº”ç”¨
GET    /api/apps/:id                # è·å–åº”ç”¨è¯¦æƒ…

GET    /api/patches                 # è·å–è¡¥ä¸åˆ—è¡¨
POST   /api/patches                 # ä¸Šä¼ è¡¥ä¸
GET    /api/patches/:id             # è·å–è¡¥ä¸è¯¦æƒ…
PUT    /api/patches/:id             # æ›´æ–°è¡¥ä¸
DELETE /api/patches/:id             # åˆ é™¤è¡¥ä¸

GET    /api/check-update            # æ£€æŸ¥æ›´ï¿½?
GET    /api/download/:id            # ä¸‹è½½è¡¥ä¸

GET    /api/stats/dashboard         # ä»ªè¡¨æ¿ç»Ÿï¿½?
GET    /api/stats/downloads         # ä¸‹è½½ç»Ÿè®¡
```

#### æ•°æ®åº“è®¾ï¿½?

```sql
-- ç”¨æˆ·ï¿½?
users
â”œâ”€â”€ id (ä¸»é”®)
â”œâ”€â”€ username (ç”¨æˆ·ï¿½?
â”œâ”€â”€ password (å¯†ç å“ˆå¸Œ)
â”œâ”€â”€ role (è§’è‰²: admin/user)
â””â”€â”€ created_at (åˆ›å»ºæ—¶é—´)

-- åº”ç”¨ï¿½?
apps
â”œâ”€â”€ id (ä¸»é”®)
â”œâ”€â”€ app_id (åº”ç”¨ ID)
â”œâ”€â”€ name (åº”ç”¨åç§°)
â”œâ”€â”€ package_name (åŒ…å)
â”œâ”€â”€ user_id (æ‰€å±ç”¨ï¿½?
â””â”€â”€ created_at (åˆ›å»ºæ—¶é—´)

-- è¡¥ä¸ï¿½?
patches
â”œâ”€â”€ id (ä¸»é”®)
â”œâ”€â”€ app_id (åº”ç”¨ ID)
â”œâ”€â”€ version (ç‰ˆæœ¬ï¿½?
â”œâ”€â”€ base_version (åŸºçº¿ç‰ˆæœ¬)
â”œâ”€â”€ file_path (æ–‡ä»¶è·¯å¾„)
â”œâ”€â”€ file_size (æ–‡ä»¶å¤§å°)
â”œâ”€â”€ md5 (MD5 å“ˆå¸Œ)
â”œâ”€â”€ status (çŠ¶ï¿½? draft/published/archived)
â”œâ”€â”€ rollout_percentage (ç°åº¦ç™¾åˆ†ï¿½?
â”œâ”€â”€ download_count (ä¸‹è½½æ¬¡æ•°)
â””â”€â”€ created_at (åˆ›å»ºæ—¶é—´)

-- ä¸‹è½½è®°å½•ï¿½?
downloads
â”œâ”€â”€ id (ä¸»é”®)
â”œâ”€â”€ patch_id (è¡¥ä¸ ID)
â”œâ”€â”€ device_id (è®¾å¤‡ ID)
â”œâ”€â”€ ip_address (IP åœ°å€)
â””â”€â”€ downloaded_at (ä¸‹è½½æ—¶é—´)
```

---

## ğŸ”„ æ ¸å¿ƒç®—æ³•

### 1. DEX çƒ­æ›´æ–°ç®—ï¿½?

**åŸç†**: ä¿®æ”¹ ClassLoader ï¿½?dexElements æ•°ç»„

```java
// 1. è·å– PathClassLoader
ClassLoader classLoader = context.getClassLoader();

// 2. åå°„è·å– pathList å­—æ®µ
Field pathListField = BaseDexClassLoader.class.getDeclaredField("pathList");
pathListField.setAccessible(true);
Object pathList = pathListField.get(classLoader);

// 3. åå°„è·å– dexElements å­—æ®µ
Field dexElementsField = pathList.getClass().getDeclaredField("dexElements");
dexElementsField.setAccessible(true);
Object[] oldDexElements = (Object[]) dexElementsField.get(pathList);

// 4. åŠ è½½è¡¥ä¸ DEX
DexFile patchDex = DexFile.loadDex(patchDexPath, ...);

// 5. åˆ›å»ºæ–°çš„ dexElementsï¼ˆè¡¥ä¸åœ¨å‰ï¼‰
Object[] newDexElements = new Object[oldDexElements.length + 1];
newDexElements[0] = patchDexElement;  // è¡¥ä¸ DEX
System.arraycopy(oldDexElements, 0, newDexElements, 1, oldDexElements.length);

// 6. æ›¿æ¢ dexElements
dexElementsField.set(pathList, newDexElements);
```

**å…³é”®ï¿½?*:
- è¡¥ä¸ DEX å¿…é¡»åœ¨æ•°ç»„å‰é¢ï¼ˆä¼˜å…ˆåŠ è½½ï¿½?
- ç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æœºï¿½?
- å·²åŠ è½½çš„ç±»æ— æ³•æ›¿æ¢ï¼ˆéœ€è¦é‡å¯ï¼‰

---

### 2. èµ„æºçƒ­æ›´æ–°ç®—ï¿½?

**åŸç†**: æ›¿æ¢ AssetManager

```java
// 1. åˆ›å»ºæ–°çš„ AssetManager
AssetManager newAssetManager = AssetManager.class.newInstance();

// 2. æ·»åŠ è¡¥ä¸èµ„æºè·¯å¾„
Method addAssetPath = AssetManager.class.getMethod("addAssetPath", String.class);
addAssetPath.invoke(newAssetManager, patchResourcePath);

// 3. æ·»åŠ åŸå§‹ APK è·¯å¾„ï¼ˆä½œä¸ºåŸºçº¿ï¼‰
addAssetPath.invoke(newAssetManager, apkPath);

// 4. æ›¿æ¢æ‰€ï¿½?Resources å¯¹è±¡ï¿½?AssetManager
// åŒ…æ‹¬ï¼šApplicationã€Activityã€ContextImpl ï¿½?
replaceAssetManager(context, newAssetManager);
```

**å…³é”®ï¿½?*:
- `resources.arsc` å¿…é¡»ä½¿ç”¨ STORE æ¨¡å¼ï¼ˆä¸å‹ç¼©ï¿½?
- éœ€è¦é‡ï¿½?Activity æ‰èƒ½çœ‹åˆ°æ–°èµ„ï¿½?
- éœ€è¦æ›¿æ¢æ‰€ï¿½?Resources å¯¹è±¡

---

### 3. SO åº“çƒ­æ›´æ–°ç®—æ³•

**åŸç†**: ä¿®æ”¹ ClassLoader ï¿½?nativeLibraryPathElements

```java
// 1. è·å– PathClassLoader
ClassLoader classLoader = context.getClassLoader();

// 2. åå°„è·å– pathList å­—æ®µ
Field pathListField = BaseDexClassLoader.class.getDeclaredField("pathList");
pathListField.setAccessible(true);
Object pathList = pathListField.get(classLoader);

// 3. åå°„è·å– nativeLibraryPathElements å­—æ®µ
Field nativeLibraryPathElementsField = 
    pathList.getClass().getDeclaredField("nativeLibraryPathElements");
nativeLibraryPathElementsField.setAccessible(true);
Object[] oldElements = (Object[]) nativeLibraryPathElementsField.get(pathList);

// 4. åˆ›å»ºæ–°çš„ nativeLibraryPathElementsï¼ˆè¡¥ä¸åœ¨å‰ï¼‰
Object[] newElements = new Object[oldElements.length + 1];
newElements[0] = patchSoElement;  // è¡¥ä¸ SO
System.arraycopy(oldElements, 0, newElements, 1, oldElements.length);

// 5. æ›¿æ¢ nativeLibraryPathElements
nativeLibraryPathElementsField.set(pathList, newElements);
```

**å…³é”®ï¿½?*:
- è¡¥ä¸ SO å¿…é¡»åœ¨æ•°ç»„å‰é¢ï¼ˆä¼˜å…ˆåŠ è½½ï¿½?
- å·²åŠ è½½çš„ SO æ— æ³•æ›¿æ¢ï¼ˆéœ€è¦é‡å¯ï¼‰
- ä¸åŒ ABI éœ€è¦ä¸åŒçš„ SO æ–‡ä»¶

---

### 4. BsDiff å¢é‡ç®—æ³•

**åŸç†**: äºŒè¿›åˆ¶å·®å¼‚ç®—ï¿½?

```
æ—§æ–‡ï¿½? [A B C D E F]
æ–°æ–‡ï¿½? [A B X D E Y]

å·®å¼‚æ–‡ä»¶:
- ä¿æŒ: A B (offset: 0, length: 2)
- æ›¿æ¢: C ï¿½?X (offset: 2, length: 1)
- ä¿æŒ: D E (offset: 3, length: 2)
- æ›¿æ¢: F ï¿½?Y (offset: 5, length: 1)
```

**ä¼˜åŠ¿**:
- è¡¥ä¸æ–‡ä»¶å°ï¼ˆåªåŒ…å«å·®å¼‚ï¼‰
- é€‚åˆå¤§æ–‡ä»¶ï¼ˆï¿½?DEXã€SOï¿½?
- å‹ç¼©ç‡é«˜ï¼ˆé€šå¸¸ 10-30%ï¿½?

---

## ğŸ”’ å®‰å…¨æœºåˆ¶

### 1. ç­¾åéªŒè¯æµç¨‹

```
è¡¥ä¸æ–‡ä»¶ (patch.zip)
    ï¿½?
[è¯»å–ç­¾åä¿¡æ¯]
    â”œâ”€â”€ META-INF/MANIFEST.MF
    â”œâ”€â”€ META-INF/CERT.SF
    â””â”€â”€ META-INF/CERT.RSA
    ï¿½?
[è·å– APK ç­¾å]
    â””â”€â”€ PackageManager.getPackageInfo()
    ï¿½?
[æ¯”å¯¹ç­¾å]
    â”œâ”€â”€ è¯ä¹¦é“¾åŒ¹é…ï¼Ÿ
    â”œâ”€â”€ ç­¾åç®—æ³•åŒ¹é…ï¿½?
    â””â”€â”€ æ‘˜è¦éªŒè¯é€šè¿‡ï¿½?
    ï¿½?
[éªŒè¯ç»“æœ]
    â”œâ”€â”€ ï¿½?é€šè¿‡ ï¿½?ç»§ç»­åº”ç”¨
    â””â”€â”€ ï¿½?å¤±è´¥ ï¿½?æ‹’ç»å¹¶æ¸…ï¿½?
```

### 2. åŠ å¯†æµç¨‹

```
åŸå§‹è¡¥ä¸ (patch.zip)
    ï¿½?
[ç”Ÿæˆå¯†é’¥]
    â”œâ”€â”€ æ–¹å¼1: ç”¨æˆ·å¯†ç  ï¿½?PBKDF2 ï¿½?AES Key
    â”œâ”€â”€ æ–¹å¼2: Android KeyStore ï¿½?AES Key
    â””â”€â”€ æ–¹å¼3: ZIP å¯†ç 
    ï¿½?
[AES-256-GCM åŠ å¯†]
    â”œâ”€â”€ åŠ å¯†æ•°æ®
    â”œâ”€â”€ ç”Ÿæˆ IV (åˆå§‹åŒ–å‘ï¿½?
    â””â”€â”€ ç”Ÿæˆ Auth Tag (è®¤è¯æ ‡ç­¾)
    ï¿½?
åŠ å¯†è¡¥ä¸ (patch.enc)
    â”œâ”€â”€ Header: [IV][Auth Tag]
    â””â”€â”€ Body: [Encrypted Data]
```

### 3. é˜²ç¯¡æ”¹æœºï¿½?

```
åº”ç”¨è¡¥ä¸ï¿½?
    ï¿½?
[è®¡ç®— SHA-256]
    â””â”€â”€ ä¿å­˜åˆ°åŠ å¯†å­˜ï¿½?
    ï¿½?
æ¯æ¬¡å¯åŠ¨ï¿½?
    ï¿½?
[é‡æ–°è®¡ç®— SHA-256]
    ï¿½?
[æ¯”å¯¹å“ˆå¸Œå€¼]
    â”œâ”€â”€ ï¿½?åŒ¹é… ï¿½?æ­£å¸¸åŠ è½½
    â””â”€â”€ ï¿½?ä¸åŒ¹ï¿½?ï¿½?è‡ªåŠ¨æ¢å¤
        ï¿½?
    [ä»åŠ å¯†å­˜å‚¨æ¢å¤]
        â”œâ”€â”€ æ¢å¤æˆåŠŸ ï¿½?ç»§ç»­
        â””â”€â”€ æ¢å¤å¤±è´¥ ï¿½?æ¸…é™¤è¡¥ä¸
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. è¡¥ä¸ç”Ÿæˆä¼˜åŒ–

- **å¹¶è¡Œå¤„ç†**: å¤šçº¿ç¨‹å¤„ç†å¤šï¿½?DEX æ–‡ä»¶
- **å¢é‡ç®—æ³•**: BsDiff å‡å°‘è¡¥ä¸å¤§å°
- **Native åŠ ï¿½?*: C/C++ å®ç°æ ¸å¿ƒç®—æ³•
- **æµå¼å¤„ç†**: é¿å…å¤§æ–‡ï¿½?OOM

### 2. è¡¥ä¸åº”ç”¨ä¼˜åŒ–

- **å»¶è¿ŸåŠ è½½**: éå…³é”®èµ„æºå»¶è¿ŸåŠ ï¿½?
- **ç¼“å­˜æœºåˆ¶**: ç¼“å­˜å·²è§£æçš„æ•°æ®
- **å†…å­˜ä¼˜åŒ–**: åŠæ—¶é‡Šæ”¾ä¸ç”¨çš„èµ„ï¿½?
- **å¼‚æ­¥å¤„ç†**: åå°çº¿ç¨‹å¤„ç†è€—æ—¶æ“ä½œ

### 3. å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–

- **é¢„åŠ ï¿½?*: Application.onCreate ä¸­é¢„åŠ è½½
- **æ‡’åŠ ï¿½?*: æŒ‰éœ€åŠ è½½è¡¥ä¸å†…å®¹
- **ç¼“å­˜éªŒè¯**: ç¼“å­˜ç­¾åéªŒè¯ç»“æœ

---

## ğŸ”§ æ‰©å±•æ€§è®¾ï¿½?

### 1. æ’ä»¶åŒ–æ¶ï¿½?

```java
interface PatchPlugin {
    void onBeforePatch(PatchInfo info);
    void onAfterPatch(PatchResult result);
    void onError(Exception e);
}

// æ³¨å†Œæ’ä»¶
HotUpdateHelper.getInstance()
    .registerPlugin(new LogPlugin())
    .registerPlugin(new MonitorPlugin())
    .registerPlugin(new CrashReportPlugin());
```

### 2. è‡ªå®šä¹‰å¼•ï¿½?

```java
interface PatchEngine {
    boolean isAvailable();
    PatchResult generate(ApkInfo base, ApkInfo target);
}

// æ³¨å†Œè‡ªå®šä¹‰å¼•ï¿½?
PatchGenerator.Builder()
    .customEngine(new MyCustomEngine())
    .build();
```

### 3. å›è°ƒæ‰©å±•

```java
interface PatchCallback {
    void onProgress(int percent, String message);
    void onSuccess(PatchResult result);
    void onError(String message);
}

// æ”¯æŒå¤šä¸ªå›è°ƒ
HotUpdateHelper.getInstance()
    .addCallback(callback1)
    .addCallback(callback2)
    .applyPatch(patchFile);
```

---

## ğŸ“ è®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªåŠŸï¿½?
2. **å¼€é—­åŸï¿½?*: å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³ï¿½?
3. **ä¾èµ–å€’ç½®**: ä¾èµ–æŠ½è±¡è€Œä¸æ˜¯å…·ä½“å®ï¿½?
4. **æ¥å£éš”ç¦»**: æ¥å£æœ€å°åŒ–ï¼Œé¿å…è‡ƒï¿½?
5. **ç»„åˆä¼˜äºç»§æ‰¿**: ä½¿ç”¨ç»„åˆè€Œä¸æ˜¯ç»§ï¿½?

---

## ğŸ¯ æœªæ¥è§„åˆ’

1. **æ’ä»¶åŒ–æ”¯ï¿½?*: åŠ¨æ€åŠ è½½æ’ï¿½?
2. **ç»„ä»¶åŒ–æ”¯ï¿½?*: æ¨¡å—åŒ–çƒ­æ›´æ–°
3. **è·¨å¹³å°æ”¯ï¿½?*: Flutterã€React Native
4. **äº‘ç«¯é›†æˆ**: CDNã€æ¨é€é€šçŸ¥
5. **AI ä¼˜åŒ–**: æ™ºèƒ½å·®å¼‚åˆ†æã€è‡ªåŠ¨å›ï¿½?

---

## ğŸ“š å‚è€ƒèµ„ï¿½?

- [Android ClassLoader æœºåˆ¶](https://source.android.com/docs/core/runtime/dex-format)
- [AssetManager æºç åˆ†æ](https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/content/res/AssetManager.java)
- [BsDiff ç®—æ³•è®ºæ–‡](http://www.daemonology.net/bsdiff/)
- [APK ç­¾åæœºåˆ¶](https://source.android.com/docs/security/features/apksigning)



---

## ğŸ” åŠ å¯†æ¶æ„è®¾è®¡

### æ¨¡å—èŒè´£åˆ†ç¦»

ä¸ºäº†å®ç°æ›´æ¸…æ™°çš„æ¶æ„å’Œæ›´å¥½çš„æ¨¡å—è§£è€¦ï¼ŒåŠ å¯†åŠŸèƒ½è¢«åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„ç±»ï¼š

#### PatchEncryptorï¼ˆpatch-generator-android æ¨¡å—ï¼‰

**èŒè´£**ï¼šè¡¥ä¸ç”Ÿæˆæ—¶çš„åŠ å¯†

```java
PatchEncryptor
â”œâ”€â”€ encryptPatch()                    // ä½¿ç”¨ KeyStore åŠ å¯†
â”œâ”€â”€ encryptPatchWithPassword()        // ä½¿ç”¨å¯†ç åŠ å¯†
â”œâ”€â”€ encrypt()                         // åŠ å¯†å­—èŠ‚æ•°ç»„
â”œâ”€â”€ getOrCreateEncryptionKey()        // å¯†é’¥ç®¡ç†
â””â”€â”€ deriveKeyFromPassword()           // å¯†ç æ´¾ç”Ÿå¯†é’¥
```

**ç‰¹ç‚¹**ï¼š
- ä»…ç”¨äº**ç”Ÿæˆè¡¥ä¸æ—¶åŠ å¯†**
- ä¸åŒ…å«è§£å¯†åŠŸèƒ½
- ä½¿ç”¨ AES-256-GCM + PBKDF2
- æ”¯æŒ Android KeyStore å’Œè‡ªå®šä¹‰å¯†ç ä¸¤ç§æ–¹å¼

#### SecurityManagerï¼ˆupdate æ¨¡å—ï¼‰

**èŒè´£**ï¼šè¡¥ä¸åº”ç”¨æ—¶çš„è§£å¯†å’ŒéªŒè¯

```java
SecurityManager
â”œâ”€â”€ decryptPatch()                    // ä½¿ç”¨ KeyStore è§£å¯†
â”œâ”€â”€ decryptPatchWithPassword()        // ä½¿ç”¨å¯†ç è§£å¯†
â”œâ”€â”€ decrypt()                         // è§£å¯†å­—èŠ‚æ•°ç»„
â”œâ”€â”€ verifySignature()                 // éªŒè¯ç­¾å
â””â”€â”€ secureDelete()                    // å®‰å…¨åˆ é™¤
```

**ç‰¹ç‚¹**ï¼š
- ä»…ç”¨äº**åº”ç”¨è¡¥ä¸æ—¶è§£å¯†**
- ä¸åŒ…å«åŠ å¯†åŠŸèƒ½ï¼ˆå·²ç§»é™¤ï¼‰
- ä½¿ç”¨ç›¸åŒçš„åŠ å¯†ç®—æ³•ç¡®ä¿å…¼å®¹æ€§
- æ”¯æŒç­¾åéªŒè¯

### åŠ å¯†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è¡¥ä¸ç”Ÿæˆç«¯ï¼ˆè®¾å¤‡æˆ–æœåŠ¡å™¨ï¼‰                        â”‚
â”‚                                                               â”‚
â”‚  åŸºçº¿ APK + æ–°ç‰ˆ APK                                          â”‚
â”‚         â†“                                                     â”‚
â”‚  [ç”Ÿæˆè¡¥ä¸] â†’ patch.zip                                       â”‚
â”‚         â†“                                                     â”‚
â”‚  [PatchEncryptor.encryptPatchWithPassword()]                 â”‚
â”‚         â†“                                                     â”‚
â”‚  patch.zip.enc (åŠ å¯†è¡¥ä¸)                                     â”‚
â”‚         â†“                                                     â”‚
â”‚  [ä¸Šä¼ åˆ°æœåŠ¡å™¨æˆ–åˆ†å‘]                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®¢æˆ·ç«¯åº”ç”¨                                 â”‚
â”‚                                                               â”‚
â”‚  [ä¸‹è½½åŠ å¯†è¡¥ä¸] â†’ patch.zip.enc                               â”‚
â”‚         â†“                                                     â”‚
â”‚  [SecurityManager.decryptPatchWithPassword()]                â”‚
â”‚         â†“                                                     â”‚
â”‚  patch.zip (è§£å¯†åçš„è¡¥ä¸)                                     â”‚
â”‚         â†“                                                     â”‚
â”‚  [HotUpdateHelper.applyPatch()]                              â”‚
â”‚         â†“                                                     â”‚
â”‚  è¡¥ä¸åº”ç”¨æˆåŠŸ                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŠ å¯†ç®—æ³•å…¼å®¹æ€§

ä¸¤ä¸ªç±»ä½¿ç”¨**å®Œå…¨ç›¸åŒ**çš„åŠ å¯†ç®—æ³•å’Œå‚æ•°ï¼Œç¡®ä¿äº’æ“ä½œæ€§ï¼š

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| åŠ å¯†ç®—æ³• | AES-256-GCM | è®¤è¯åŠ å¯†ï¼Œé˜²ç¯¡æ”¹ |
| å¯†é’¥é•¿åº¦ | 256 bits | é«˜å®‰å…¨çº§åˆ« |
| IV é•¿åº¦ | 12 bytes | GCM æ ‡å‡† |
| Auth Tag | 128 bits | è®¤è¯æ ‡ç­¾ |
| å¯†é’¥æ´¾ç”Ÿ | PBKDF2WithHmacSHA256 | ä»å¯†ç æ´¾ç”Ÿå¯†é’¥ |
| è¿­ä»£æ¬¡æ•° | 10,000 | PBKDF2 è¿­ä»£ |
| ç›å€¼ | "OrangeHotUpdateSalt2024" | å›ºå®šç›å€¼ |

### ä½¿ç”¨ç¤ºä¾‹

#### è®¾å¤‡ç«¯ç”Ÿæˆå¹¶åŠ å¯†

```java
// 1. ç”Ÿæˆè¡¥ä¸
AndroidPatchGenerator generator = new AndroidPatchGenerator.Builder(context)
    .baseApk(baseApk)
    .newApk(newApk)
    .output(patchFile)
    .callback(new SimpleAndroidGeneratorCallback() {
        @Override
        public void onComplete(PatchResult result) {
            if (result.isSuccess()) {
                // 2. åŠ å¯†è¡¥ä¸
                PatchEncryptor encryptor = new PatchEncryptor(context);
                String password = "your_secure_password";
                File encryptedPatch = encryptor.encryptPatchWithPassword(
                    result.getPatchFile(), 
                    password
                );
                
                // 3. ä¸Šä¼ æˆ–åˆ†å‘åŠ å¯†è¡¥ä¸
                uploadPatch(encryptedPatch);
            }
        }
    })
    .build();

generator.generateInBackground();
```

#### å®¢æˆ·ç«¯åº”ç”¨åŠ å¯†è¡¥ä¸

```java
// 1. ä¸‹è½½åŠ å¯†è¡¥ä¸
File encryptedPatch = downloadPatch();

// 2. åº”ç”¨åŠ å¯†è¡¥ä¸ï¼ˆè‡ªåŠ¨è§£å¯†ï¼‰
HotUpdateHelper helper = new HotUpdateHelper(context);
String password = "your_secure_password";
helper.applyPatchWithAesPassword(encryptedPatch, password, new HotUpdateHelper.Callback() {
    @Override
    public void onSuccess(PatchResult result) {
        Log.i(TAG, "è¡¥ä¸åº”ç”¨æˆåŠŸï¼");
    }
    
    @Override
    public void onError(String message) {
        Log.e(TAG, "è¡¥ä¸åº”ç”¨å¤±è´¥: " + message);
    }
});
```

### è®¾è®¡ä¼˜åŠ¿

1. **èŒè´£æ¸…æ™°**ï¼š
   - `PatchEncryptor` ä¸“æ³¨äºè¡¥ä¸ç”Ÿæˆæ—¶çš„åŠ å¯†
   - `SecurityManager` ä¸“æ³¨äºè¡¥ä¸åº”ç”¨æ—¶çš„è§£å¯†å’ŒéªŒè¯

2. **æ¨¡å—è§£è€¦**ï¼š
   - ç”¨æˆ·åªéœ€ä¾èµ– `update` æ¨¡å—å³å¯åº”ç”¨è¡¥ä¸
   - æ— éœ€ä¾èµ– `patch-generator-android` æ¨¡å—

3. **çµæ´»éƒ¨ç½²**ï¼š
   - è¡¥ä¸å¯ä»¥åœ¨è®¾å¤‡ç«¯ç”Ÿæˆå¹¶åŠ å¯†
   - ä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ CLI å·¥å…·ç”Ÿæˆå¹¶åŠ å¯†
   - å®¢æˆ·ç«¯åªéœ€è¦è§£å¯†å’Œåº”ç”¨åŠŸèƒ½

4. **å‘åå…¼å®¹**ï¼š
   - `SecurityManager` ä¿ç•™äº†æ‰€æœ‰è§£å¯†æ–¹æ³•
   - ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹å³å¯ç»§ç»­ä½¿ç”¨

5. **å®‰å…¨æ€§**ï¼š
   - ä½¿ç”¨ç›¸åŒçš„åŠ å¯†ç®—æ³•ç¡®ä¿å…¼å®¹æ€§
   - æ”¯æŒå¤šç§åŠ å¯†æ–¹å¼ï¼ˆKeyStoreã€å¯†ç ï¼‰
   - é˜²æ­¢è¡¥ä¸è¢«çªƒå–æˆ–é€†å‘åˆ†æ
