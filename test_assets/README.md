# Test Assets

This directory contains test files for Android Hot Update system.

## Files

### APK Files
- **app-v1.2-release.apk** - Base version APK (version 1.2, 11.62 MB)
- **app-v1.3-release.apk** - Updated version APK (version 1.3, 11.62 MB)

### Patch Files
- **patch-v1.2-to-v1.3.zip** - Patch generated by Android SDK (966 KB)
- **patch-cli-generated.zip** - Patch generated by patch-cli tool (964 KB)
- **test-patch-final.zip** - Earlier test patch (959 KB)

### Patch Files
- **patch-v1.2-to-v1.3.zip** - Patch generated by Android SDK on-device (966 KB)
- **patch-cli-generated.zip** - Patch generated by patch-cli command-line tool (964 KB)
- **test-patch-final.zip** - Earlier test patch (959 KB)

## Patch Generation Methods

### Method 1: Android SDK (On-Device)
Generated using `AndroidPatchGenerator` on Android device:
```java
AndroidPatchGenerator generator = new AndroidPatchGenerator.Builder(context)
    .baseApk(baseApkFile)
    .newApk(newApkFile)
    .output(patchFile)
    .build();
generator.generateInBackground();
```
- **Result**: `patch-v1.2-to-v1.3.zip` (966 KB)
- **Time**: ~8 seconds
- **Engine**: Native (BsDiff)

### Method 2: Command-Line Tool (patch-cli)
Generated using `patch-cli` JAR on PC:
```bash
java -jar patch-cli-1.3.1-all.jar \
  --base app-v1.2-release.apk \
  --new app-v1.3-release.apk \
  --output patch-cli-generated.zip \
  --verbose
```
- **Result**: `patch-cli-generated.zip` (964 KB)
- **Time**: 5.16 seconds
- **Engine**: Auto (Java fallback)

### Method 3: Gradle Plugin
Can be generated during build process:
```gradle
patchGenerator {
    baselineApk = file("baseline/app-v1.2.apk")
    outputDir = file("build/patch")
}
```

## Detailed Test Report

See [PATCH_CLI_TEST.md](PATCH_CLI_TEST.md) for detailed patch-cli test results.

## Usage

### Testing with patch-cli Generated Patch
1. Install `app-v1.2-release.apk` on device
2. Push `patch-cli-generated.zip` to device:
   ```bash
   adb push test_assets/patch-cli-generated.zip /sdcard/Download/
   ```
3. Open the app and select the patch file
4. Apply patch using HotUpdateHelper
5. Verify app updates to v1.3 with âš?symbol

### Testing with Android SDK Generated Patch
1. Install `app-v1.2-release.apk`
2. Push `patch-v1.2-to-v1.3.zip` to device
3. Apply patch using HotUpdateHelper
4. Verify app updates to v1.3 functionality

## Security Features Tested

### Signature Verification
- All patches are signed with the same key as the APK
- Signature verification prevents tampering
- If signature is removed or modified, patch will be rejected

### Encryption
- Encrypted patch uses AES-256-GCM encryption
- Password is stored separately for security
- Decryption happens automatically during patch application

### Integrity Check
- SHA-256 hash verification for all patches
- Prevents corrupted or modified patches from being applied
- Hash is verified before and after decryption

## Test Scenarios

1. **patch-cli Command-Line Generation**
   - Generate patch on PC using Java
   - Fast generation (5.16s for 11MB APKs)
   - Optimal compression (8.11% ratio)
   - Cross-platform support

2. **Android SDK On-Device Generation**
   - Generate patch directly on Android device
   - Native engine acceleration
   - No PC required

3. **Patch Application**
   - Apply patch without app restart
   - DEX and SO changes take effect immediately
   - Resources require activity restart

4. **Version Verification**
   - Check version code upgrade (2 â†?3)
   - Verify UI changes (âš?symbol added)
   - Confirm new assets loaded

## Notes

- All patches are generated from the same base (v1.2) and target (v1.3) APKs
- Patches contain identical changes but may vary slightly in size due to compression
- patch-cli uses Java engine, Android SDK can use Native engine
- All patches are compatible with the hot update system
- Patches can be applied using HotUpdateHelper API

## File Locations

### On PC
- APKs: `test_assets/app-v*.apk`
- Patches: `test_assets/*.zip`
- CLI Tool: `patch-cli/build/libs/patch-cli-1.3.1-all.jar`

### On Android Device
- APKs: `/sdcard/Download/app-v*.apk`
- Patches: `/sdcard/Download/*.zip`
- Applied patches: `/data/data/com.orange.update.demo/files/patch/`

